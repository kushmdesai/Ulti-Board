// Copyright 2023 QMK
// SPDX-License-Identifier: GPL2.0-or-later
#include <stdbool.h>
#include <stdint.h>
#include "timer.h"
#include QMK_KEYBOARD_H
bool boot_image_shown = false;
uint32_t boot_start_timer;
uint8_t boot_stage = 0;
uint32_t boot_timer = 0;

void keyboard_post_init_user(void) {
    boot_timer = timer_read();
}

#include QMK_KEYBOARD_H
//naming the layers
enum layer_names {
    _Main,
    _Mods
};

enum custom_keycodes {
    COPY = SAFE_RANGE,  // Start at SAFE_RANGE to avoid conflicts
    COPY_ALL,
    PASTE,
    CUT,
    UNDO,
    REDO,
    NEW_TAB,
    ALT_TAB,
    CLOSE_TAB,
    HACK_MODE,
};

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [0] = LAYOUT(
        KC_ESC,  KC_1, KC_2,    KC_3,    KC_4,   KC_5,   KC_6,   KC_7,    KC_8,   KC_9,      KC_0,      KC_MINS,   KC_EQL,   KC_BSPC,      KC_PGUP,
        KC_TAB,  KC_Q, KC_W,    KC_E,    KC_R,   KC_T,   KC_Y,   KC_U,    KC_I,   KC_O,      KC_P,      KC_LBRC,   KC_RBRC,  KC_BSLS,      KC_PGDN,
        KC_CAPS, KC_A, KC_S,    KC_D,    KC_F,   KC_G,   KC_H,   KC_J,    KC_K,   KC_L,      KC_SCLN,   KC_QUOT,   KC_ENT,                 KC_DEL,    
        KC_LSFT,       KC_Z,    KC_X,    KC_C,   KC_V,   KC_B,   KC_N,    KC_M,   KC_COMM,   KC_DOT,    KC_SLSH,   KC_RSFT,      KC_UP,    TO(1),
        KC_LCTL,       KC_LWIN, KC_LALT, KC_NO,                  KC_SPC,                     KC_RALT,   KC_PSCR,       KC_LEFT,  KC_DOWN,  KC_RGHT
    ),
    [1] = LAYOUT(
        UG_TOGG, COPY,    COPY_ALL, PASTE,   CUT,      UNDO,     REDO,    NEW_TAB, ALT_TAB,   CLOSE_TAB, HACK_MODE, KC_MNXT,  KC_VOLU, KC_BRIU,     QK_RBT,
        UG_NEXT, RGB_M_P, RGB_M_B,  RGB_M_R, RGB_M_SW, RGB_M_SN, RGB_M_K, RGB_M_X, RGB_M_G,   RGB_M_T,   RGB_M_TW,  KC_MPLY,  KC_VOLD, KC_BRID,     QK_BOOT,
        UG_VALU, KC_A,    KC_S,     KC_D,    KC_F,     KC_G,     KC_H,    KC_J,    KC_K,      KC_L,      KC_SCLN,   KC_MPRV,  KC_MUTE,              KC_PWR,    
        KC_LSFT,          UG_HUEU,  UG_SATU, KC_C,     KC_V,     KC_B,    KC_N,    KC_M,      KC_COMM,   KC_DOT,    KC_SLSH,  KC_RSFT,     MS_UP,   TO(0),
        UG_SPDU,          UG_HUED,  UG_SATD, KC_NO,                       VK_TOGG,                       KC_RALT,   KC_PSCR,      MS_LEFT, MS_DOWN, MS_RGHT
    )
};

static void render_hackermode(void) {
    oled_clear();
    oled_set_cursor(0, 0);
    oled_write(">> Connecting...", false);
    oled_set_cursor(0, 1);
    oled_write(">> Injecting Code", false);
    oled_set_cursor(0, 2);
    oled_write(">> Host Infected", false);
    oled_set_cursor(0, 3);
    oled_write(">> Hello, Hacker", false);
}

bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    if (record->event.pressed) {
        switch (keycode) {
            case COPY:
                SEND_STRING(SS_LCTL("c"));
                return false;
            case COPY_ALL:
                SEND_STRING(SS_LCTL("ac"));
            case PASTE:
                SEND_STRING(SS_LCTL("v"));
                return false;
            case CUT:
                SEND_STRING(SS_LCTL("x"));
                return false;
            case UNDO:
                SEND_STRING(SS_LCTL("z"));
                return false;
            case REDO:
                register_code(KC_LCTL);
                register_code(KC_LSFT);
                tap_code(KC_Z);
                unregister_code(KC_LSFT);
                unregister_code(KC_LCTL);
                return false;
            case NEW_TAB:
                register_code(KC_LCTL);
                register_code(KC_LSFT);
                tap_code(KC_T);
                unregister_code(KC_LSFT);
                unregister_code(KC_LCTL);
                return false;
            case ALT_TAB:
                register_code(KC_LALT);
                tap_code(KC_TAB);
                unregister_code(KC_LALT);
                return false;
            case CLOSE_TAB:
                SEND_STRING(SS_LCTL("w"));
                return false;
            case HACK_MODE:
                // maybe switch to hacker display mode later?
                render_hackermode();  // (you might need to restructure this call)
                return false;
        }
    }
    return true;
}

#ifdef OLED_ENABLE


// set cursor to top

// writing text - >
// oled_write("Hello World!", false);

    
//checking current layer and displaying text based on that- >
/* switch (get_highest_layer(layer_state)) {
    case _Main :
        oled_write("You're on the Main layer", false);
    case _Mods :
        oled_write("You're on the Mods layer")
}
*/
/* 
checking wheather caps lock is on or not and then displaying it - >
led_t led_state = host_keyboard_led_state();
oled_write_P(led_state.caps_lock ? PSTR("Caps Lock On") : PSTR("Caps Lock Off"), false);
*/

/*
displaying images on oled - >
*/
static const char  QMK_logo [] PROGMEM = {
    // 'QMK logo-withtext-128x32', 128x32px
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0x3f, 0x3f, 0x0f, 0x0f, 
    0x3f, 0x0f, 0x0f, 0x3f, 0x07, 0x1f, 0x1f, 0x07, 0x1f, 0x1f, 0x0f, 0x3f, 0x3f, 0x7f, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xa5, 0xa5, 0x00, 0x00, 0x00, 0x00, 0x7e, 
    0xfe, 0x00, 0x00, 0x00, 0xfe, 0x00, 0x00, 0x00, 0x80, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x04, 0xa5, 
    0xbd, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0xf3, 0xf3, 0xf3, 
    0x03, 0x07, 0x8f, 0xff, 0xff, 0x3f, 0x0f, 0x07, 0xe3, 0xf3, 0xf3, 0xf3, 0xe3, 0x07, 0x0f, 0x3f, 
    0xff, 0xff, 0x3f, 0x0f, 0x07, 0xe3, 0xf3, 0xf3, 0xe3, 0xc7, 0x07, 0x0f, 0x7f, 0xff, 0xf3, 0xf3, 
    0xf3, 0x03, 0x03, 0x03, 0xf3, 0xf3, 0xf3, 0xff, 0xff, 0x03, 0x03, 0x03, 0xff, 0xff, 0xff, 0x03, 
    0x03, 0x83, 0x0f, 0x3f, 0xff, 0xff, 0x03, 0x03, 0xff, 0xff, 0xff, 0x3f, 0x0f, 0x07, 0xc7, 0xe3, 
    0xf3, 0xf3, 0xe3, 0xe7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xf6, 0xf4, 0xc0, 0x80, 0x80, 0x00, 0x00, 
    0x81, 0x01, 0x01, 0x83, 0x0f, 0x83, 0x83, 0x01, 0x81, 0x80, 0x00, 0x80, 0x80, 0xc0, 0xe0, 0xf6, 
    0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x80, 0x80, 0x9c, 0x9c, 0x9c, 
    0x8c, 0x80, 0xc1, 0xe7, 0xff, 0xf8, 0xe0, 0xc0, 0x8f, 0x9f, 0x9f, 0x9f, 0x8f, 0xc0, 0xe0, 0xf8, 
    0xff, 0xff, 0xf8, 0xe0, 0xc0, 0x8f, 0x9f, 0x9f, 0x8f, 0xc7, 0xc0, 0xe0, 0xfc, 0xff, 0xff, 0xff, 
    0xff, 0x80, 0x80, 0x80, 0xff, 0xff, 0xff, 0xff, 0xff, 0x80, 0x80, 0x80, 0xff, 0xff, 0xff, 0x80, 
    0x80, 0xff, 0xfe, 0xf8, 0xe0, 0x83, 0x80, 0x80, 0xff, 0xff, 0xff, 0xf8, 0xe0, 0xc0, 0x8f, 0x8f, 
    0x9c, 0x9c, 0x80, 0xc0, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xfe, 0xfe, 
    0xff, 0xfe, 0xfe, 0xff, 0xfe, 0xff, 0xff, 0xfe, 0xff, 0xff, 0xfe, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
    0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff
};

static const char  HCbranding [] PROGMEM = {
    // 'flag-orpheus-left-bw_128x32', 128x32px <----- hackclub branding (I wanted to get some branding for highway but was unable find some in Black and White)
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x20, 0x20, 0x40, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe0, 0xf8, 0xfc, 0xfc, 0x1c, 0x0e, 
    0x7e, 0x7e, 0x3e, 0x1c, 0xfc, 0xfc, 0x3c, 0x38, 0xf8, 0xf8, 0xf0, 0x70, 0x70, 0xe0, 0xe0, 0xc0, 
    0xc0, 0xc0, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xc0, 
    0xc0, 0x40, 0x60, 0xe0, 0xe0, 0xf0, 0xf0, 0x98, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x02, 0x02, 0x02, 0x04, 0x04, 0x44, 
    0x38, 0x18, 0x08, 0x08, 0x10, 0x30, 0xe0, 0x30, 0x1c, 0x1f, 0x1f, 0x1f, 0x1f, 0x3d, 0x3c, 0x3e, 
    0x3e, 0x30, 0x78, 0x7f, 0x73, 0xf8, 0xe9, 0xe0, 0xff, 0xe3, 0xc0, 0xde, 0xfe, 0x9f, 0xc1, 0xe1, 
    0x03, 0xfb, 0xff, 0xff, 0xff, 0x87, 0x3b, 0x7b, 0xff, 0x83, 0xbf, 0xbf, 0xf9, 0xe7, 0xdf, 0xe1, 
    0xfe, 0x71, 0x34, 0x31, 0x1f, 0x0f, 0x0f, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x3c, 0x03, 0x00, 
    0x00, 0x00, 0x60, 0xd2, 0xd3, 0x1d, 0x98, 0x51, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x03, 0x03, 0x03, 
    0x03, 0x03, 0x03, 0x03, 0x07, 0x07, 0x07, 0x07, 0x03, 0x03, 0x03, 0x03, 0x01, 0x01, 0x01, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x08, 0x10, 0x10, 0x10, 0x20, 0x20, 0x20, 0x00, 0x00, 0x4f, 0x70, 0x40, 0x40, 
    0x20, 0x16, 0x0f, 0x19, 0x11, 0x13, 0x0d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};



static void render_currentlayer(void) {
    oled_set_cursor(0,2);
    switch (get_highest_layer(layer_state)) {
        case _Main :
            oled_write("You're on the Main layer", false);
            break;
        case _Mods :
            oled_write("You're on the Mods layer", false);
            break;
    }      
}

static void render_capslock(void) {
    oled_set_cursor(0,3);
    led_t led_state = host_keyboard_led_state();
    oled_write_P(led_state.caps_lock ? PSTR("Caps Lock On") : PSTR("Caps Lock Off"), false);
}

static void render_wpm(void) {
    oled_set_cursor(0,1);
    oled_write_P(PSTR("WPM: "), false);
    oled_write_ln_P(PSTR(""), false); // New line for WPM value
    char buf[10];
    sprintf(buf, "%u", get_current_wpm());
    oled_write(buf, false);
}

oled_rotation_t oled_init_user(oled_rotation_t rotation) {
    if (!is_keyboard_master()) {
        return OLED_ROTATION_180; // Example for slave display
    }
    return rotation;
}

bool oled_task_user(void) {
    // Stage 0: QMK logo + "Booting..."
    if (boot_stage == 0) {
        oled_clear();
        oled_write_raw_P(QMK_logo, sizeof(QMK_logo));  // QMK logo, top portion

        if (timer_elapsed(boot_timer) > 3000) {  // 3 seconds
            boot_stage = 1;
            boot_timer = timer_read();  // reset timer
        }
        
    }

    // Stage 1: Custom image (no text)
    if (boot_stage == 1) {
        oled_clear();
        oled_write_raw_P(HCbranding, sizeof(HCbranding));  // Your full-screen logo/image

        if (timer_elapsed(boot_timer) > 3000) {  // 3 seconds
            boot_stage = 2;
        }
        
    }

    // Stage 2: Normal OLED content
    render_wpm();
    render_currentlayer();
    render_capslock();
    return false;
}

#endif